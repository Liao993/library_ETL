# Google Form Setup Guide

## Form Design

Your Google Form will collect book borrowing and returning transactions using a simplified approach that doesn't require dynamic dropdowns.

## Form Questions

### 1. Teacher Name
- **Type**: Short answer text
- **Required**: Yes
- **Description**: "Enter your full name"

### 2. Category
- **Type**: Multiple choice (dropdown)
- **Required**: Yes
- **Options**: 
  - Category A
  - Category B
  - Category C
- **Description**: "Select the book category"

### 3. Book Label Number
- **Type**: Short answer text
- **Required**: Yes
- **Validation**: Number only
- **Description**: "Enter the book number (e.g., 018, 042, 123)"
- **Help text**: "Find this number on the book label"

### 4. Action Type
- **Type**: Multiple choice (dropdown)
- **Required**: Yes
- **Options**:
  - Borrow
  - Return
- **Description**: "Are you borrowing or returning this book?"

### 5. Date (Manual Entry)
- **Type**: Date
- **Required**: No
- **Description**: "If this is a past transaction, enter the date. Leave blank for today."

### 6. Timestamp
- **Type**: Auto-generated (built-in Google Forms feature)
- **Enable**: Go to Settings → Responses → "Collect email addresses" is NOT needed, but timestamp is automatic

## How Book IDs Work

The system will combine the category and label number to create the book ID:

| Category | Label Number | Combined Book ID |
|----------|--------------|------------------|
| Category A | 018 | A-018 |
| Category B | 042 | B-042 |
| Category C | 123 | C-123 |

## Setting Up the Form

1. **Create the Google Form**
   - Go to [Google Forms](https://forms.google.com)
   - Create a new form
   - Add the questions listed above

2. **Link to Google Sheets**
   - In your form, click "Responses"
   - Click the Google Sheets icon
   - Create a new spreadsheet or select existing one
   - This creates a linked sheet that auto-updates

3. **Get the Spreadsheet ID**
   - Open the linked Google Sheet
   - Copy the ID from the URL:
     ```
     https://docs.google.com/spreadsheets/d/[SPREADSHEET_ID]/edit
     ```
   - Save this ID for the Airbyte configuration

4. **Set Up API Access**
   - Follow the instructions in `/credentials/README.md`
   - Create a service account
   - Share the Google Sheet with the service account email
   - Download credentials JSON

## Expected Sheet Columns

After form submissions, your Google Sheet will have these columns:

| Column Name | Description | Example |
|-------------|-------------|---------|
| Timestamp | Auto-generated by Google Forms | 12/4/2024 21:30:45 |
| Teacher Name | From question 1 | John Smith |
| Category | From question 2 | Category A |
| Book Label Number | From question 3 | 018 |
| Action Type | From question 4 | Borrow |
| Date (Manual Entry) | From question 5 | 12/3/2024 |

## Data Pipeline Processing

The ETL pipeline will:

1. **Extract**: Pull data from Google Sheets via Airbyte
2. **Transform**:
   - Combine "Category" + "Book Label Number" → Book ID (e.g., "A-018")
   - Match "Teacher Name" to teacher_id in database
   - Use "Timestamp" if "Date (Manual Entry)" is blank
   - Validate that the book exists
3. **Load**: Insert transaction and update book status

## Book Labeling Recommendations

For this system to work smoothly, ensure your physical books are labeled clearly:

### Label Format
```
┌─────────────────┐
│   Category: A   │
│   Number: 018   │
│                 │
│   Book ID:      │
│   A-018         │
└─────────────────┘
```

### Labeling Best Practices

1. **Use clear, large fonts** so teachers can easily read the numbers
2. **Place labels in consistent locations** (e.g., spine or inside cover)
3. **Use durable labels** that won't peel off
4. **Consider color-coding** categories (e.g., Category A = Blue, B = Green, C = Red)

## Testing the Form

1. Submit a test entry
2. Check that it appears in the Google Sheet
3. Verify the columns match the expected format
4. Run the Airbyte sync to test data flow

## Troubleshooting

### Common Issues

**Teacher enters wrong category**
- The system will create an invalid book ID (e.g., "B-018" when book is "A-018")
- Data quality checks will flag this
- Solution: Clear labeling on books

**Teacher enters wrong number**
- Similar to above, creates non-existent book ID
- Validation will catch this during ETL
- Solution: Train teachers to double-check the number

**Duplicate entries**
- If a teacher submits twice for the same book
- Deduplication logic keeps the latest entry
- No action needed

**Missing teacher in database**
- Fuzzy matching will attempt to find similar names
- If no match, the transaction will be flagged for review
- Solution: Add teacher to database first

## Next Steps

After setting up the form:

1. Share the form link with teachers
2. Configure Airbyte connection (see Airbyte setup guide)
3. Set up Airflow DAG to run sync every 15-30 minutes
4. Monitor the first few submissions to ensure everything works
